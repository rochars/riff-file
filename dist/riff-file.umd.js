Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{value:function(searchElement,fromIndex){if(null==this)throw new TypeError('"this" is null or not defined');var o=Object(this),len=o.length>>>0;if(0===len)return!1;var x,y,n=0|fromIndex,k=Math.max(n>=0?n:len-Math.abs(n),0);for(;k<len;){if((x=o[k])===(y=searchElement)||"number"==typeof x&&"number"==typeof y&&isNaN(x)&&isNaN(y))return!0;k++}return!1}}),String.prototype.codePointAt||function(){"use strict";var defineProperty=function(){try{var object={},$defineProperty=Object.defineProperty,result=$defineProperty(object,object,object)&&$defineProperty}catch(error){}return result}(),codePointAt=function(position){if(null==this)throw TypeError();var string=String(this),size=string.length,index=position?Number(position):0;if(index!=index&&(index=0),!(index<0||index>=size)){var second,first=string.charCodeAt(index);return first>=55296&&first<=56319&&size>index+1&&(second=string.charCodeAt(index+1))>=56320&&second<=57343?1024*(first-55296)+second-56320+65536:first}};defineProperty?defineProperty(String.prototype,"codePointAt",{value:codePointAt,configurable:!0,writable:!0}):String.prototype.codePointAt=codePointAt}(),Uint8Array.prototype.slice||Object.defineProperty(Uint8Array.prototype,"slice",{value:Array.prototype.slice}),function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory():"function"==typeof define&&define.amd?define(factory):global.RIFFFile=factory()}(this,function(){"use strict";function endianness(bytes,offset){var start=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,end=arguments.length>3&&void 0!==arguments[3]?arguments[3]:bytes.length;if(end%offset)throw new Error("Bad buffer length.");for(var index=start;index<end;index+=offset)swap(bytes,offset,index)}function swap(bytes,offset,index){offset--;for(var x=0;x<offset;x++){var theByte=bytes[index+x];bytes[index+x]=bytes[index+offset],bytes[index+offset]=theByte,offset--}}var TYPE_ERR="Unsupported type";var classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),get=function get(object,property,receiver){null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc)return desc.value;var getter=desc.get;return void 0!==getter?getter.call(receiver):void 0},possibleConstructorReturn=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call},IEEE754Buffer=function(){function IEEE754Buffer(ebits,fbits){classCallCheck(this,IEEE754Buffer),this.ebits=ebits,this.fbits=fbits,this.bias=(1<<ebits-1)-1,this.numBytes=Math.ceil((ebits+fbits)/8),this.biasP2=Math.pow(2,this.bias+1),this.ebitsFbits=ebits+fbits,this.fbias=Math.pow(2,-(8*this.numBytes-1-ebits))}return createClass(IEEE754Buffer,[{key:"pack",value:function(buffer,num,index){Math.abs(num)>this.biasP2-2*this.ebitsFbits&&(num=num<0?-1/0:1/0);var sign=((num=+num)||1/num)<0?1:num<0?1:0;num=Math.abs(num);var exp=Math.min(Math.floor(Math.log(num)/Math.LN2),1023),fraction=this.roundToEven(num/Math.pow(2,exp)*Math.pow(2,this.fbits));return num!=num?(fraction=Math.pow(2,this.fbits-1),exp=(1<<this.ebits)-1):0!==num&&(num>=Math.pow(2,1-this.bias)?(fraction/Math.pow(2,this.fbits)>=2&&(exp+=1,fraction=1),exp>this.bias?(exp=(1<<this.ebits)-1,fraction=0):(exp+=this.bias,fraction=this.roundToEven(fraction)-Math.pow(2,this.fbits))):(fraction=this.roundToEven(num/Math.pow(2,1-this.bias-this.fbits)),exp=0)),this.packFloatBits_(buffer,index,sign,exp,fraction)}},{key:"unpack",value:function(buffer,index){for(var eMax=(1<<this.ebits)-1,significand=void 0,leftBits="",i=this.numBytes-1;i>=0;i--){var t=buffer[i+index].toString(2);leftBits+="00000000".substring(t.length)+t}var sign="1"==leftBits.charAt(0)?-1:1;leftBits=leftBits.substring(1);var exponent=parseInt(leftBits.substring(0,this.ebits),2);return leftBits=leftBits.substring(this.ebits),exponent==eMax?0!==parseInt(leftBits,2)?NaN:sign*(1/0):(0===exponent?(exponent+=1,significand=parseInt(leftBits,2)):significand=parseInt("1"+leftBits,2),sign*significand*this.fbias*Math.pow(2,exponent-this.bias))}},{key:"packFloatBits_",value:function(buffer,index,sign,exp,fraction){var bits=[];bits.push(sign);for(var i=this.ebits;i>0;i-=1)bits[i]=exp%2?1:0,exp=Math.floor(exp/2);for(var len=bits.length,_i=this.fbits;_i>0;_i-=1)bits[len+_i]=fraction%2?1:0,fraction=Math.floor(fraction/2);for(var str=bits.join(""),numBytes=this.numBytes+index-1,k=index;numBytes>=index;)buffer[numBytes]=parseInt(str.substring(0,8),2),str=str.substring(8),numBytes--,k++;return k}},{key:"roundToEven",value:function(n){var w=Math.floor(n),f=n-w;return f<.5?w:f>.5?w+1:w%2?w+1:w}}]),IEEE754Buffer}(),UintBuffer=function(){function UintBuffer(bits){classCallCheck(this,UintBuffer),this.bits=bits,this.bytes=bits<8?1:Math.ceil(bits/8),this.max=Math.pow(2,bits)-1,this.min=0;var r=8-(1+(bits-1|7)-bits);this.lastByteMask_=Math.pow(2,r>0?r:8)-1}return createClass(UintBuffer,[{key:"pack",value:function(buffer,num){var index=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(num!=num)throw new Error("NaN");this.overflow(num),buffer[index]=255&(num<0?num+Math.pow(2,this.bits):num),index++;for(var len=this.bytes,i=2;i<len;i++)buffer[index]=255&Math.floor(num/Math.pow(2,8*(i-1))),index++;return this.bits>8&&(buffer[index]=Math.floor(num/Math.pow(2,8*(this.bytes-1)))&this.lastByteMask_,index++),index}},{key:"unpack",value:function(buffer){var index=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,num=this.unpackUnsafe(buffer,index);return this.overflow(num),num}},{key:"unpackUnsafe",value:function(buffer,index){for(var num=0,x=0;x<this.bytes;x++)num+=buffer[index+x]*Math.pow(256,x);return num}},{key:"overflow",value:function(num){if(num>this.max||num<this.min)throw new Error("Overflow")}}]),UintBuffer}(),TwosComplementBuffer=function(_UintBuffer){function TwosComplementBuffer(bits){classCallCheck(this,TwosComplementBuffer);var _this=possibleConstructorReturn(this,(TwosComplementBuffer.__proto__||Object.getPrototypeOf(TwosComplementBuffer)).call(this,bits));return _this.max=Math.pow(2,_this.bits)/2-1,_this.min=-_this.max-1,_this}return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(TwosComplementBuffer,UintBuffer),createClass(TwosComplementBuffer,[{key:"pack",value:function(buffer,num){var index=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return get(TwosComplementBuffer.prototype.__proto__||Object.getPrototypeOf(TwosComplementBuffer.prototype),"pack",this).call(this,buffer,num,index)}},{key:"unpack",value:function(buffer){var index=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,num=get(TwosComplementBuffer.prototype.__proto__||Object.getPrototypeOf(TwosComplementBuffer.prototype),"unpackUnsafe",this).call(this,buffer,index);return num=this.sign_(num),this.overflow(num),num}},{key:"sign_",value:function(num){return num>this.max&&(num-=2*this.max+2),num}}]),TwosComplementBuffer}(),NumberBuffer=function(){function NumberBuffer(bits,fp,signed){classCallCheck(this,NumberBuffer);var parser=void 0;fp?(!function(bits){if(!bits||16!==bits&&32!==bits&&64!==bits)throw new Error(TYPE_ERR+": float, bits: "+bits)}(bits),parser=this.getFPParser_(bits)):(!function(bits){if(!bits||bits<1||bits>53)throw new Error(TYPE_ERR+": int, bits: "+bits)}(bits),parser=signed?new TwosComplementBuffer(bits):new UintBuffer(bits)),this.parser=parser,this.offset=Math.ceil(bits/8)}return createClass(NumberBuffer,[{key:"unpack",value:function(buffer){var index=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.parser.unpack(buffer,index)}},{key:"pack",value:function(buffer,num){var index=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.parser.pack(buffer,num,index)}},{key:"getFPParser_",value:function(bits){return 16===bits?new IEEE754Buffer(5,11):32===bits?new IEEE754Buffer(8,23):new IEEE754Buffer(11,52)}}]),NumberBuffer}();function unpackString(buffer){return function(buffer){for(var start=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,end=arguments.length>2&&void 0!==arguments[2]?arguments[2]:buffer.length,str="",index=start;index<end;){var lowerBoundary=128,upperBoundary=191,replace=!1,charCode=buffer[index++];if(charCode>=0&&charCode<=127)str+=String.fromCharCode(charCode);else{var count=0;charCode>=194&&charCode<=223?count=1:charCode>=224&&charCode<=239?(count=2,224===buffer[index]&&(lowerBoundary=160),237===buffer[index]&&(upperBoundary=159)):charCode>=240&&charCode<=244?(count=3,240===buffer[index]&&(lowerBoundary=144),244===buffer[index]&&(upperBoundary=143)):replace=!0,charCode&=(1<<8-count-1)-1;for(var i=0;i<count;i++)(buffer[index]<lowerBoundary||buffer[index]>upperBoundary)&&(replace=!0),charCode=charCode<<6|63&buffer[index],index++;replace?str+=String.fromCharCode(65533):charCode<=65535?str+=String.fromCharCode(charCode):(charCode-=65536,str+=String.fromCharCode(55296+(charCode>>10&1023),56320+(1023&charCode)))}}return str}(buffer,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:buffer.length)}function unpackArrayTo(buffer,theType,output){var start=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,end=arguments.length>4&&void 0!==arguments[4]?arguments[4]:buffer.length,safe=arguments.length>5&&void 0!==arguments[5]&&arguments[5],packer=new NumberBuffer((theType=theType||{}).bits,theType.fp,theType.signed),offset=packer.offset;end=function(buffer,start,end,offset,safe){var extra=(end-start)%offset;if(safe&&(extra||buffer.length<offset))throw new Error("Bad buffer length");return end-extra}(buffer,start,end,offset,safe);var index=0,j=start;try{for(theType.be&&endianness(buffer,offset,start,end);j<end;j+=offset,index++)output[index]=packer.unpack(buffer,j);theType.be&&endianness(buffer,offset,start,end)}catch(e){!function(e,value,i,fp){throw fp||value!==1/0&&value!==-1/0&&value==value?new Error(e.message+" at input index "+i+": "+value):new Error("Argument is not a integer at input index "+i)}(e,buffer.slice(j,j+offset),j,theType.fp)}}function unpack$1(buffer,theType){var index=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return function(buffer,theType){var output=[];return unpackArrayTo(buffer,theType,output,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,arguments.length>3&&void 0!==arguments[3]?arguments[3]:buffer.length,arguments.length>4&&void 0!==arguments[4]&&arguments[4]),output}(buffer,theType,index,index+Math.ceil(theType.bits/8),!0)[0]}return function(){function RIFFFile(){classCallCheck(this,RIFFFile),this.container="",this.chunkSize=0,this.format="",this.signature={},this.head=0,this.uInt32={bits:32,be:!1},this.supported_containers=["RIFF","RIFX"]}return createClass(RIFFFile,[{key:"setSignature",value:function(buffer){if(this.head=0,this.container=this.readString(buffer,4),-1===this.supported_containers.indexOf(this.container))throw Error("Not a supported format.");this.uInt32.be="RIFX"===this.container,this.chunkSize=this.readUInt32(buffer),this.format=this.readString(buffer,4),this.signature={chunkId:this.container,chunkSize:this.chunkSize,format:this.format,subChunks:this.getSubChunksIndex_(buffer)}}},{key:"findChunk",value:function(chunkId){for(var multiple=arguments.length>1&&void 0!==arguments[1]&&arguments[1],chunks=this.signature.subChunks,chunk=[],i=0;i<chunks.length;i++)if(chunks[i].chunkId==chunkId){if(!multiple)return chunks[i];chunk.push(chunks[i])}return"LIST"==chunkId&&chunk.length?chunk:null}},{key:"readString",value:function(bytes,maxSize){var str;return str=unpackString(bytes,this.head,this.head+maxSize),this.head+=maxSize,str}},{key:"readUInt32",value:function(bytes){var value=unpack$1(bytes,this.uInt32,this.head);return this.head+=4,value}},{key:"getSubChunksIndex_",value:function(buffer){for(var chunks=[],i=this.head;i<=buffer.length-8;)chunks.push(this.getSubChunkIndex_(buffer,i)),i=(i+=8+chunks[chunks.length-1].chunkSize)%2?i+1:i;return chunks}},{key:"getSubChunkIndex_",value:function(buffer,index){var chunk={chunkId:this.getChunkId_(buffer,index),chunkSize:this.getChunkSize_(buffer,index)};if("LIST"==chunk.chunkId)chunk.format=unpackString(buffer,index+8,index+12),this.head+=4,chunk.subChunks=this.getSubChunksIndex_(buffer);else{var realChunkSize=chunk.chunkSize%2?chunk.chunkSize+1:chunk.chunkSize;this.head=index+8+realChunkSize,chunk.chunkData={start:index+8,end:this.head}}return chunk}},{key:"getChunkId_",value:function(buffer,index){return this.head+=4,unpackString(buffer,index,index+4)}},{key:"getChunkSize_",value:function(buffer,index){return this.head+=4,unpack$1(buffer,this.uInt32,index+4)}}]),RIFFFile}()});
